<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UK TV Guide</title>
    <style>
        body {
            display: flex;
            justify-content: center;
            align-items: flex-start;
            flex-direction: row;
            text-align: center;
            font-family: Arial, sans-serif;
            background-color: #f0f0f0;
            padding: 20px;
        }

        .tv-guide {
            display: flex;
            width: 90%;
            max-width: 1000px;
        }

        .channel-list, .schedule {
            width: 50%;
            margin: 10px;
        }

        h2 {
            font-size: 1.5em;
            margin-bottom: 10px;
        }

        ul {
            list-style: none;
            padding: 0;
        }

        ul li {
            margin: 5px 0;
            cursor: pointer;
            padding: 10px;
            background-color: #fff;
            border: 1px solid #ddd;
            border-radius: 4px;
        }

        ul li:hover {
            background-color: #e0e0e0;
        }

        .schedule-item {
            margin: 10px 0;
            padding: 10px;
            background-color: #fff;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
    </style>
</head>
<body>
    <h1>UK TV Guide</h1>
    <div class="tv-guide">
        <div class="channel-list">
            <h2>Channels</h2>
            <ul id="channel-list">
                <!-- Channels will be populated here -->
            </ul>
        </div>
        <div class="schedule">
            <h2>Schedule</h2>
            <div id="schedule-container">
                <!-- Schedule will be displayed here -->
            </div>
        </div>
    </div>

    <script>
        // Function to fetch the UK TV schedule for a specific date
        function getUkTvSchedule(date) {
            var xhr = new XMLHttpRequest();
            xhr.open('GET', 'https://api.tvmaze.com/schedule?country=GB&date=' + date, true);

            xhr.onload = function() {
                if (xhr.status >= 200 && xhr.status < 300) {
                    var data = JSON.parse(xhr.responseText);
                    console.log("Data fetched successfully:", data); // Log data for debugging
                    populateChannels(data);
                } else {
                    alert("Error fetching data: " + xhr.status);
                }
            };

            xhr.onerror = function() {
                alert("Request failed. Please try again later.");
            };

            xhr.send();
        }

        // Function to populate the channel list
        function populateChannels(data) {
            var channelList = document.getElementById('channel-list');
            channelList.innerHTML = ''; // Clear previous channels

            var channels = {}; // Track unique channels
            for (var i = 0; i < data.length; i++) {
                var item = data[i];
                if (item.show.network && !channels[item.show.network.name]) {
                    channels[item.show.network.name] = true;

                    var li = document.createElement('li');
                    li.textContent = item.show.network.name;
                    li.onclick = (function(channelName) {
                        return function() {
                            filterByChannel(channelName, data);
                        };
                    })(item.show.network.name);

                    channelList.appendChild(li);
                }
            }
        }

        // Function to filter shows by channel
        function filterByChannel(channelName, data) {
            var scheduleContainer = document.getElementById('schedule-container');
            scheduleContainer.innerHTML = ''; // Clear previous schedule

            for (var i = 0; i < data.length; i++) {
                var item = data[i];
                if (item.show.network && item.show.network.name === channelName) {
                    var div = document.createElement('div');
                    div.className = 'schedule-item';
                    div.innerHTML = `<strong>${item.show.name}</strong> - ${item.airtime}`;
                    scheduleContainer.appendChild(div);
                }
            }
        }

        // Get today's date in YYYY-MM-DD format
        var today = new Date().toISOString().split('T')[0];

        // Fetch the schedule for today when the page loads
        getUkTvSchedule(today);
    </script>
</body>
</html>